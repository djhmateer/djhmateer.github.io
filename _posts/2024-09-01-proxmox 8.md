---
layout: post
# title: LLM Run Locally with CPU and Text Generation WebUI 
description: 
menu: review
categories: proxmox 
published: true 
comments: false     
sitemap: false
image: /assets/2024-05-03/4.jpg
---

I've been running Proxmox 7 in production for the last 2.5 years. It's been sitting in my home on a small PC (Silver) connected straight to the router and has been incredably useful. 

- started with [bare metal](https://davemateer.com/2022/01/12/home-web-server)
- moved to [Proxmox 7 beginners guide](https://davemateer.com/2022/01/12/home-web-server)


## Lessons Learned

- SSD's fail. 
- Hardware fails.
- You always need more disk space than you think on a VM
- Home connection with dynamic DNS has been great. Was 48Mbps down and 12MMbps up. Now on fibre at 500/110.
- Backups are super important
- Template VM's useful for spinning up test VM's quickly
- pfSense is hard
- System has been very reliable
- Been invaluable for archiving as many services now (eg YouTube) will block cloud based IP's


## General Setup

- Server is set to auto power on (in bios) in event of power cycle 

- Router forwards port 80 and 443 (and sometimes port 22) to pfSense
- [pfsense](https://www.pfsense.org/) for NAT and Firewall
- Nginx reverse proxy forwards web traffic to appropriate internal website VMs
- Access point for admin while I'm away is an Ubuntu VM with SSH keys and [fail2ban](https://github.com/fail2ban/fail2ban) and [here](/2022/07/29/proxmox#secure-ssh-remote-access---part-5)

I can connect to any VM via my WSL2

```bash
# have mapped different ports to different internal machines
ssh pfsense -p 39

```

## VM Websites / APIs

[http://mateer.hopto.org/](http://mateer.hopto.org/) is the name I got from [https://www.noip.com/](https://www.noip.com/) which my router talks to to provide dynamic DNS.

I've got an Nginx reverse proxy in front of all websites which forwards traffic to a specific internal IP via http. It also handles certificates via [certbot](/2023/10/12/certbot-on-nginx-reverse-proxy)

- [hoverflylagoons.co.uk](https://hoverflylagoons.co.uk/) - Apache / PHP . MySQL - 2GB
- [theskatefarmcic.co.uk](https://theskatefarmcic.co.uk/) - Apache / PHP / MySQL - 2GB
- API that runs a hatespeech AI called from [https://osr4rightstools.org/](https://osr4rightstools.org/)
- website that runs firemap called from 

Maybe move over

- [https://osr4rightstools.org/](https://osr4rightstools.org/) - .NET 1GB RAM. **todo** - certbot for certs
- [https://auto-archiver.com/](https://auto-archiver.com/) - .NET 1GB RAM **todo** certbot for certs
- [https://arlawesi.org.uk/](https://arlawesi.org.uk/) - .NET 1GB RAM **todo** certbot for certs

Test sites

- [https://hmsoftware.org/](https://hmsoftware.org/) - test site #1. Have used for Rails 
- [https://hmsoftware.uk/](https://hmsoftware.uk/)


Sites hosted elsewhere

- [https://hmsoftware.co.uk](https://hmsoftware.co.uk) - static site hosted on [netlify.com](https://www.netlify.com/) main company website which is being developed soon into a portfolio site
- [homebrewbeer.netlify.app](https://homebrewbeer.netlify.app/) - Hugo based static site on Netlify
- [https://davemateer.com/](https://davemateer.com/) - Jekyll blog on [pages.github.com/](https://pages.github.com/)


## VM Workers 

- General archiver eg [auto-archiver.com/](https://auto-archiver.com/) - Python which runs fine in 4GB RAM
- Tweet service that polls an Azure database every minute to see if any Tweets to send out. Python. 1GB RAM
- YouTube screenshotter archiver - I'm using [playwright.dev](https://playwright.dev/) via a Proxy [brightdata.com/](https://brightdata.com/) and using headful Firefox 

## Networking

Plusnet Two Router / DHCP is on [192.168.1.254](http://192.168.1.254/)

Proxmox is on a static IP allocation of [192.168.1.139](http://192.168.1.139:8006/) - port 8006 gives us the Proxmox web UI

pfSense VM has a DHCP (!fix this) alloction of [192.168.1.144](https://192.168.1.144:8080/) - port 8080 gives us the pfSense web UI

All port 80 and 443 traffic is routed to pfSense from the router.

## Power Costs

Big server may draw 300W at idle. eg dual xeon

My UK provider [good energy]() charges me 24.70 pence per kWh on 3rd Sept 2024. And 59.18 pence per day 

So the xeon server would cost 0.3 kW x 24 hours = 7.2 kWh/day = £1.78 / day
£53 / month

My 13th Gen Intel draws about 40W at idle running wifi, disks, etc..

### RGB Machine

40W at rest it draws = 0.04 kW * 24 hours = 0.96 kWh/day = £0.237 per day = £7 per month

## Hardware


## Storage in Proxmox - Nomenclature

**HERE**

I've been running for years with a single SSD for boot and Disk images. And a USB mounted ext4 external disk for backups.

Datacenter, Storage

ID, Type, Content

- local, Directory, "VZDump backup file, ISO image, Container Template"
- local-lvm, LVM-Thin, "Disk Image, Container"
- local-usb, Directory, "VZDump backup file, Disk Image"



## Storage

Drive Writes Per Day (DWPD) - how many times the entire capacity can be written per day over warrenty period. eg 1TB SSD DWPD rating of 1 - can write 1TB every day for 3 to 5 years.

SATA DOM (Disk on Module) - often used for boot drives.
SATA SSD - 2.5"
nvme 
Mechanical - for boot not recommended.. as SSD is cheaper, lower power and more reliable.

For boot drives approx 10 TB/year is a good number.. so shouldn't wear out the SSD at all.


So after my drive failure(s) of consumer ssd's, I want to make my server more resilient.

- m.2 2 * 1TB just for extra relaibility (check DWPD). He uses 2 x 256 AirDisk SSD
- SSD

Mirror the m.2 drives for the OS
 

 ## Logs

 Look for problems eg 

 ```bash
Sep 02 06:54:11 pve smartd[718]: Device: /dev/sda [SAT], SMART Usage Attribute: 190 Airflow_Temperature_Cel changed from 68 to 69
Sep 02 06:54:12 pve smartd[718]: Device: /dev/sdb [SAT], 8 Currently unreadable (pending) sectors
Sep 02 06:54:12 pve smartd[718]: Device: /dev/sdb [SAT], 8 Offline uncorrectable sectors
 ```

 My sdb is a mechanical disk I'm not using.


 ## Disks

<!-- [![alt text](/assets/2024-09-04/1.jpg "email"){:width="500px"}](/assets/2024-09-04/1.jpg) -->
[![alt text](/assets/2024-09-04/1.jpg "email")](/assets/2024-09-04/1.jpg)

Have got 26% wearout on this Samsung SSD 840 Pro. This is my backup server which I'm rebuilding soon.

This is nothing to worry about and drive shoudl still have plenty of life left.

## Mount USB Memeory Stick (backup)



## New Server Install - Prime


[https://www.proxmox.com/en/downloads](https://www.proxmox.com/en/downloads) Proxmox VE 8.2-2 - Aug 22nd 2024

[https://etcher.balena.io/](https://etcher.balena.io/) to flash a USB


My Black (and Silver) Proxmox servers are running under


