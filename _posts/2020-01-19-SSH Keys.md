---
layout: post
title: SSH Keys 
description: 
menu: review
categories: SSH 
published: true 
comments: false     
sitemap: false
image: /assets/2019-11-13/3.jpg
---

![alt text](/assets/2020-01-09/20.jpg "Connecting to a Linux VM using SSH Keys"){:width="600px"}  

An SSH Key (public/private key pair) is the preferred way to connect to a Linux VM.  The benefits are:

- Don't need a password (super handy)
- More secure as can't brute force

[MS Documentation](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-ssh-keys-detailed#overview-of-ssh-and-keys)

## Azure CLI generate-ssh-keys

A handy way to create or use existing ssh keys when creating a new vm on Azure:

```bash
az vm create --name davetest110 --resource-group rg --generate-ssh-keys

## connect to VM
ssh dave@davetest110.westeurope.cloudapp.azure.com

## connect to the VM ignoring initial do you trust prompt
ssh -o StrictHostKeyChecking=no dave@davetest110.westeurope.cloudapp.azure.com
```

Inside WSL this will create or use inside `~/.ssh`

- id_rsa.pub - public key
- id_rsa - private key

## StrictHostKeyChecking

Command is useful to ignore the fingerprint check and add the host to the known_hosts file in `~/.ssh`

![alt text](/assets/2020-01-09/22.jpg "Handy to ignore the fingerprint check"){:width="600px"}  

At the end of my build script I echo out the ssh command:

![alt text](/assets/2020-01-09/23.jpg "Ignore the fingerprint check"){:width="600px"}  

## Username

![alt text](/assets/2020-01-09/21.jpg "Getting ssh connection string from Azure UI"){:width="500px"}  

I used the above to figure out the username `dave` to connect with. This is the username of the `WSL` user on my Windows machine.

## Connect from Windows

The above works fine connecting from WSL but I like to connect from Windows too

- Windows uses `c:\users\djhma\.ssh\id_rsa`
- WSL uses `~/.ssh/id_rsa`

So how do we share the key? [Florian has a good solution](https://florianbrinkmann.com/en/ssh-key-and-the-windows-subsystem-for-linux-3436/#comment-3109) and [a good explanation of permissions on SuperUser](https://superuser.com/a/1183228/12214)

## Connect from Multiple Machines to the VM

I use 3 machines to develop on on a regular basis:

- Work desktop machine
- Home laptop
- Home desktop machine

So do I share the public/private keys among these 3 machines to connect to my Azure Linux VM's? No!

[It is better to create separate public/private keys for each of the 3 host machines and let the newly created servers know about the 3 machines](https://stackoverflow.com/a/12100237/26086)

## Manually Create SSH Keys

ssh-keygen -m PEM -t rsa -b 4096

## Passphrases
asdf
